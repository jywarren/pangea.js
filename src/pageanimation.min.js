!function(n){"use strict";function t(){var n,t=document.createElement("fakeelement"),i={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",MSTransition:"msTransitionEnd",OTransition:"otransitionend",transition:"transitionend"};for(n in i)if(i.hasOwnProperty(n)&&void 0!==t.style[n])return i[n]}function i(n){if(n.target.href)return n.target;for(var t=0;t<n.path.length;t++)if(n.path[t].href)return n.path[t]}function o(n){return n.href.replace(window.location.origin,"")}function e(n){return this.defaults={shouldScroll:n.shouldScroll||!0,scrollTiming:n.scrollTiming||"before"},this.settings={animateLinksToSelf:n.animateLinksToSelf||!1},this.cb={computeScrollOffset:n.computeScrollOffset||function(){return 0},shouldAnimate:n.shouldAnimate||function(){return!0},beforeAnimationStart:n.beforeAnimationStart||function(){},onTransitionEnd:n.onTransitionEnd||function(){}},this.animations={},this.body=document.getElementsByTagName("body")[0],this.transitionEndEvent=t(),this.links=document.getElementsByTagName("a"),this.currentAnimation=null,this.boundOnTransitionEnd=this._onTransitionEnd.bind(this),this.boundOnClick=this._onClick.bind(this),0===this.links.length&&console.error("No links found in page."),this}e.prototype.register=function(n,t,i,o){var e=o||{},r={anchor:null,bodyClass:i,finalElement:document.getElementById(t),path:null,regex:new RegExp(n),shouldScroll:e.shouldScroll||this.defaults.shouldScroll,scrollTiming:e.scrollTiming||this.defaults.scrollTiming};return r.finalElement||console.error("No element with ID "+t),this.animations[n]=r,this},e.prototype.deregister=function(n){return this.animations[n]||console.error("No animation registered with regex "+n),delete this.animations[n],this},e.prototype.enable=function(){for(var n=0;n<this.links.length;n++)this.links[n].addEventListener("click",this.boundOnClick)},e.prototype.disable=function(){for(var n=0;n<this.links.length;n++)this.links[n].removeEventListener("click",this.boundOnClick)},e.scrollTo=function(n,t,i){function o(){setTimeout(function(){Math.abs(window.scrollY-n)>5?(requestAnimationFrame(o),c+=1,e=Math.max(0,Math.min(Math.PI,c*a)),r=l-l*Math.cos(e),window.scrollTo(0,s-r)):(window.scrollTo(0,n),i())},15)}i=i||function(){};var e,r,s=window.scrollY,a=Math.PI/(t/15),l=(s-n)/2,c=0;requestAnimationFrame(o)},e.prototype._onTransitionEnd=function(n){if(this.currentAnimation){var t=this.currentAnimation;this.currentAnimation=null;var i=function(){window.location.pathname===this.targetUrl?window.location.reload():window.location=this.targetUrl}.bind(this);t.shouldScroll&&"after"===t.scrollTiming?e.scrollTo(this.cb.computeScrollOffset(t),200,i):i()}},e.prototype._animate=function(n){this.cb.beforeAnimationStart(n),n.finalElement.addEventListener(this.transitionEndEvent,this.boundOnTransitionEnd),this.currentAnimation=n;var t=function(){this.targetUrl=n.path,this.body.className=n.bodyClass}.bind(this);n.shouldScroll&&"before"===n.scrollTiming?e.scrollTo(this.cb.computeScrollOffset(n),200,t):n.shouldScroll&&"during"===n.scrollTiming?(setTimeout(t,0),e.scrollTo(this.cb.computeScrollOffset(n),200)):t()},e.prototype._onClick=function(n){var t=i(n),e=o(t);if(!this.currentAnimation&&this.cb.shouldAnimate(t,e)&&(this.settings.animateLinksToSelf||this.path!==window.location.pathname))for(var r in this.animations)if(this.animations.hasOwnProperty(r)&&this.animations[r].regex.test(e)){n.preventDefault();var s=this.animations[r];return s.anchor=t,s.path=e,void this._animate(s)}},"function"==typeof define&&define.amd?define(e):"undefined"!=typeof module&&module.exports?module.exports=e:n.PageAnimation=e}(this);