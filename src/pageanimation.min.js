!function(t){"use strict";function n(){var t,n=document.createElement("fakeelement"),i={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",MSTransition:"msTransitionEnd",OTransition:"otransitionend",transition:"transitionend"};for(t in i)if(i.hasOwnProperty(t)&&void 0!==n.style[t])return i[t]}function i(t,n,i){function o(){setTimeout(function(){Math.abs(window.scrollY-t)>5?(requestAnimationFrame(o),h+=1,e=Math.max(0,Math.min(Math.PI,h*a)),r=l-l*Math.cos(e),window.scrollTo(0,s-r)):(window.scrollTo(0,t),i())},15)}var e,r,s=window.scrollY,a=Math.PI/(n/15),l=(s-t)/2,h=0;requestAnimationFrame(o)}function o(t){if(t.target.href)return t.target;for(var n=0;n<t.path.length;n++)if(t.path[n].href)return t.path[n]}function e(t){return t.href.replace(window.location.origin,"")}function r(t){return this.defaults={shouldScroll:t.shouldScroll||!0,scrollTiming:t.scrollTiming||"before"},this.settings={animateLinksToSelf:t.animateLinksToSelf||!1},this.cb={computeScrollOffset:t.computeScrollOffset||function(){return 0},shouldAnimate:t.shouldAnimate||function(){return!0},beforeAnimationStart:t.beforeAnimationStart||function(){},onTransitionEnd:t.onTransitionEnd||function(){}},this.animations={},this.body=document.getElementsByTagName("body")[0],this.transitionEndEvent=n(),this.links=document.getElementsByTagName("a"),this.currentAnimation=null,this.boundOnTransitionEnd=this._onTransitionEnd.bind(this),this.boundOnClick=this._onClick.bind(this),0===this.links.length&&console.error("No links found in page."),this}r.prototype.register=function(t,n,i,o){var e=o||{},r={anchor:null,bodyClass:i,finalElement:document.getElementById(n),path:null,regex:new RegExp(t),shouldScroll:e.shouldScroll||this.defaults.shouldScroll,scrollTiming:e.scrollTiming||this.defaults.scrollTiming};return r.finalElement||console.error("No element with ID "+n),this.animations[t]=r,this},r.prototype.deregister=function(t){return this.animations[t]||console.error("No animation registered with regex "+t),delete this.animations[t],this},r.prototype.enable=function(){for(var t=0;t<this.links.length;t++)this.links[t].addEventListener("click",this.boundOnClick)},r.prototype.disable=function(){for(var t=0;t<this.links.length;t++)this.links[t].removeEventListener("click",this.boundOnClick)},r.prototype._onTransitionEnd=function(t){if(this.currentAnimation){var n=this.currentAnimation;this.currentAnimation=null;var o=function(){window.location.pathname===this.targetUrl?window.location.reload():window.location=this.targetUrl}.bind(this);n.shouldScroll&&"after"===n.scrollTiming?i(this.cb.computeScrollOffset(n),200,o):o()}},r.prototype._animate=function(t){this.cb.beforeAnimationStart(t),t.finalElement.addEventListener(this.transitionEndEvent,this.boundOnTransitionEnd),this.currentAnimation=t;var n=function(){this.targetUrl=t.path,this.body.className=t.bodyClass}.bind(this);t.shouldScroll&&"before"===t.scrollTiming?i(this.cb.computeScrollOffset(t),200,n):t.shouldScroll&&"during"===t.scrollTiming?(setTimeout(n,0),i(this.cb.computeScrollOffset(t),200)):n()},r.prototype._onClick=function(t){var n=o(t),i=e(n);if(!this.currentAnimation&&this.cb.shouldAnimate()&&(this.settings.animateLinksToSelf||this.path!==window.location.pathname))for(var r in this.animations)if(this.animations.hasOwnProperty(r)&&this.animations[r].regex.test(i)){t.preventDefault();var s=this.animations[r];return s.anchor=n,s.path=i,void this._animate(s)}},"function"==typeof define&&define.amd?define(r):"undefined"!=typeof module&&module.exports?module.exports=r:t.PageAnimation=r}(this);